<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Details</title>
    <link
      rel="shortcut icon"
      href="/images/favicon.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="/css/animate.css" />
    <link rel="stylesheet" href="/css/tailwind.css" />

    <!-- ==== WOW JS ==== -->
    <script src="/js/wow.min.js"></script>
    <script>
      new WOW().init();
    </script>
  </head>

  <body>
    <!-- ====== Navbar Section Start -->
    <%- include('partials/navbar') %>
    <!-- ====== Navbar Section End -->

    <!-- ====== Banner Section Start -->
    <div
      class="relative z-10 overflow-hidden pb-[60px] pt-[120px] dark:bg-dark md:pt-[130px] lg:pt-[160px]"
    >
      <div
        class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-stroke/0 via-stroke to-stroke/0 dark:via-dark-3"
      ></div>
      <div class="container">
        <div class="flex flex-wrap items-center -mx-4">
          <div class="w-full px-4">
            <div class="text-center">
              <h1
                class="mb-4 text-3xl font-bold text-dark dark:text-white sm:text-4xl md:text-[40px] md:leading-[1.2]"
              >
              <%= userDetails.username %> Detail
              </h1>
              <p class="mb-5 text-base text-body-color dark:text-dark-6">
                There are many variations of passages of Lorem Ipsum available.
              </p>

              <ul class="flex items-center justify-center gap-[10px]">
                <li>
                  <a
                    href="../index"
                    class="flex items-center gap-[10px] text-base font-medium text-dark dark:text-white"
                  >
                    Home
                  </a>
                </li>
                <li>
                  <a
                    href="javascript:void(0)"
                    class="flex items-center gap-[10px] text-base font-medium text-body-color"
                  >
                    <span class="text-body-color dark:text-dark-6"> / </span>
                    <%= userDetails.username %>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- ====== Banner Section End -->

    <!-- ====== User Info Section Start -->
    <section class="pt-10 pb-10 lg:pt-[50px] lg:pb-[50px] text-base dark:bg-dark dark:text-dark-6">
      <%- include('partials/ads') %>
      <div class="container">
        <div class="flex flex-wrap -mx-4">
          <div class="flex flex-col justify-center items-center p-5 m-auto">
            <div class="w-40 h-40 rounded-full overflow-hidden mb-6 shadow-lg">
              <img src="<%= userDetails.avatar %>" alt="image" class="w-full h-full object-cover object-center" />
            </div>
              <div class="flex flex-col items-center flex-wrap gap-2">
              
                <div class="flex items-center gap-1">
                  <h1 class="dark:text-white text-black text-4xl font-bold"><%= userDetails.username %></h1>
                  <% if (userDetails.isPremium) { %>
                    <div class="flex justify-center text-white items-center self-start w-4 h-4 p-[2px] rounded-full bg-primary">
                      <svg class="fill-current" data-name="Layer 1" id="Layer_1" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <path d="M29.51068,15.41064C19.78412,13.544,18.456,12.21582,16.58929,2.48926a.60015.60015,0,0,0-1.17871,0C13.54437,12.21582,12.21625,13.544,2.4892,15.41064a.60016.60016,0,0,0,0,1.17872c9.72705,1.86669,11.05517,3.19482,12.92138,12.92138a.60027.60027,0,0,0,1.17871,0c1.8667-9.72656,3.19483-11.05469,12.92139-12.92138a.60016.60016,0,0,0,0-1.17872Z"/>
                      </svg>
                    </div>
                  <% } %>

                  <button id="editProfileButton" class="disabled:opacity-50 disabled:pointer-events-none ml-2 px-2 py-2 rounded-md bg-primary text-white">
                    <a href="/edit-profile">
                      <svg class="fill-current text-current w-3 h-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160L0 416c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-96c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 64z"/></svg>
                    </a>

                  </button>
                </div>
                
                  <h2 class="dark:text-white text-black opacity-25 text-[16px] font-bold"><%= userDetails.fullName %></h1>
                
                <div class="flex justify-center items-center gap-2">
                  <% if (userDetails.isBanned) { %>
                    <p class="text-white bg-orange-500 px-2 py-1 rounded-md">banned</p>
                  <% } %>
                  <p class="text-white bg-primary px-2 py-1 rounded-md"><%= userDetails.role %></p>
                </div>

                <p class="dark:text-white text-black opacity-50 text-sm"><%= userDetails.email %></p>
                <p class="dark:text-white text-black opacity-50 text-sm">Last Login: <%= lastLoginTimeAgo %></p>
                <button id="followButton" class="disabled:opacity-50 disabled:pointer-events-none px-4 py-2 rounded-md <%= isFollowing ? 'bg-gray-500' : 'bg-primary' %> text-white">
                  <%= isFollowing ? 'Following' : 'Follow' %>
                </button>
                <div class="max-w-[600px] text-center">
                  <p><%= userDetails.description %></p>
                </div>
            </div>
          </div>
          <div class="flex flex-row flex-wrap gap-y-3 justify-between w-full px-4 dark:text-dark-6 text-base">

            <div class="flex flex-col text-white justify-center items-center flex-wrap bg-primary rounded-lg w-[30%] p-5">
              <p id="userBlogCount" class="sm:text-4xl text-xl font-bold overflow-hidden"><%= userBlogCount %></p>
              <p class="text-center">Blogs</p>
            </div>
            
            <div class="flex flex-col text-white justify-center items-center flex-wrap bg-primary rounded-lg w-[30%] p-5">
              <p id="totalUserViews" class="sm:text-4xl text-xl font-bold overflow-hidden"><%= totalUserViews %></p>
              <p class="text-center">Views</p>
            </div>
            
            <div class="flex flex-col text-white justify-center items-center flex-wrap bg-primary rounded-lg w-[30%] p-5">
              <p id="followersCount" class="sm:text-4xl text-xl font-bold overflow-hidden"><%= followers.length %></p>
              <p class="text-center">Followers</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- ====== User Info Section End -->

    <!-- ====== Blog Section Start -->

    <section class="pt-20 pb-10 lg:pt-[80px] lg:pb-20 dark:bg-dark">
      <div class="container flex flex-col">

        <button id="dropdownSearchButton" data-dropdown-toggle="dropdownSearch" data-dropdown-placement="bottom" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 self-end mb-5"  type="button">
          Dropdown search
          <svg class="w-2.5 h-2.5 ms-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4" />
          </svg>
        </button>
        
        <div class="flex lg:flex-row flex-col justify-between w-full gap-4">
  
          <!-- Dropdown menu -->
          <div id="dropdownSearch" class="lg:order-last z-10 lg:min-w-[200px] h-fit hidden bg-white rounded-lg shadow lg:w-80 w-full dark:bg-gray-700 lg:self-start">
            <form id="searchForm" action="/user/<%= userDetails.id %>" method="GET" class="p-4">
       
              <!-- Dropdown filters -->
              <div class="flex flex-col gap-3">

                <!-- Input search -->
                <div class="flex">
                  <label for="search-dropdown" class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Search</label>
                  <button id="dropdown-button" class="flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-900 bg-gray-100 border border-gray-300 rounded-s-lg hover:bg-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:focus:ring-gray-700 dark:text-white dark:border-gray-600" type="button">
                    <span id="search-type">Title</span>
                    <svg class="w-2.5 h-2.5 ms-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                    </svg>
                  </button>
                  <div id="dropdown" class="absolute z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700">
                    <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdown-button">
                      <li>
                        <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" onclick="setSearchType('Title')">Title</button>
                      </li>
                      <li>
                        <button type="button" class="inline-flex w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" onclick="setSearchType('Author')">Author</button>
                      </li>
                    </ul>
                  </div>
                  <div class="relative w-full">
                    <input type="search" id="search-dropdown" name="search" class="block p-2.5 w-full z-20 text-sm text-gray-900 bg-gray-50 rounded-e-lg border-s-gray-50 border-s-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-s-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:border-blue-500" placeholder="Search by title..." />
                    <input type="hidden" id="search-type-input" name="searchType" value="title">
                  </div>
                </div>

                <select name="filter" class="w-full px-4 py-2 text-sm border rounded-md dark:border-dark-3 dark:bg-gray-600 dark:text-dark-6 focus:border-blue-500 dark:focus:border-blue-500">
                  <option value="" <%= filter === '' ? 'selected' : '' %>>All</option>
                  <option value="latest" <%= filter === 'latest' ? 'selected' : '' %>>Latest</option>
                  <option value="oldest" <%= filter === 'oldest' ? 'selected' : '' %>>Oldest</option>
                  <option value="popular" <%= filter === 'popular' ? 'selected' : '' %>>Most Popular</option>
                </select>
          
                <select name="category" class="w-full px-4 py-2 text-sm border rounded-md dark:border-dark-3 dark:bg-gray-600 dark:text-dark-6 focus:border-blue-500 dark:focus:border-blue-500">
                  <option value="">All Categories</option>
                  <% categories.forEach(category => { %>
                    <option value="<%= category._id %>" <%= selectedCategory === category._id.toString() ? 'selected' : '' %>><%= category.name %></option>
                  <% }); %>
                </select>
          
                <select name="timeRange" class="w-full px-4 py-2 text-sm border rounded-md dark:border-dark-3 dark:bg-gray-600 dark:text-dark-6 focus:border-blue-500 dark:focus:border-blue-500">
                  <option value="">All Time</option>
                  <option value="24h" <%= timeRange === '24h' ? 'selected' : '' %>>Last 24 Hours</option>
                  <option value="week" <%= timeRange === 'week' ? 'selected' : '' %>>Last Week</option>
                  <option value="month" <%= timeRange === 'month' ? 'selected' : '' %>>Last Month</option>
                  <option value="year" <%= timeRange === 'year' ? 'selected' : '' %>>Last Year</option>
                </select>
  
                <div class="relative w-full">
                  <button
                    type="button"
                    id="dropdownTagButton"
                    data-dropdown-toggle="dropdown"
                    class="text-left w-full px-4 py-2 text-sm border rounded-md dark:border-dark-3 dark:bg-gray-600 dark:text-dark-6 focus:border-blue-500 dark:focus:border-blue-500">
                    Tags
                  </button>
                
                  <div
                    id="dropdownTag"
                    class="hidden h-fit overflow-auto flex-col gap-10 mt-4 absolute z-10 p-2 bg-white border border-gray-300 rounded-md shadow-lg dark:bg-gray-700 dark:border-gray-600">
                    <% tags.forEach(tag => { %>
                      <label class="flex items-center">
                        <input
                          type="checkbox"
                          name="tags"
                          value="<%= tag._id %>"
                          class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500"
                          <%= selectedTags.includes(tag._id.toString()) ? 'checked' : '' %> />
                        <span class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">
                          <%= tag.name %>
                        </span>
                      </label>
                    <% }); %>
                  </div>
                </div>
                <!-- Checkbox for isPremium -->
                <div class="mt-4">
                  <label class="flex items-center">
                    <input
                      type="checkbox"
                      name="isPremium"
                      value="true"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500"
                        />
                    <span class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">
                      Premium
                    </span>
                  </label>
                </div>

              </div>  
          
              <!-- Submit button -->
              <div class="mt-4">
                <button type="submit" class="w-full px-5 py-2 text-white bg-blue-700 hover:bg-blue-800 rounded-lg text-sm focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700">Search</button>
              </div>
            </form>
          </div>
  
          <div id="blogContainer" class="flex flex-row flex-wrap justify-center w-full">
            <%- include('partials/blogs', { blogs: blogs }) %>
          </div>
  
        </div>
      </div>

      <div id="paginationContainer" class="mt-8 text-center wow fadeInUp" data-wow-delay=".2s">
        <%- include('partials/pagination', {
          currentPage: currentPage,
          hasNextPage: hasNextPage,
          hasPreviousPage: hasPreviousPage,
          nextPage: nextPage,
          previousPage: previousPage,
          lastPage: lastPage,
          oldUrl: `/user/${userDetails._id}?`
        }) %>
      </div>
    </section>
    <!-- ====== Blog Section end -->

    <!-- ====== Footer Section Start -->
    <%- include('partials/footer') %>
    <!-- ====== Footer Section End -->

    <!-- ====== Back To Top Start -->
    <a
      href="javascript:void(0)"
      class="back-to-top fixed bottom-8 left-auto right-8 z-[999] hidden h-10 w-10 items-center justify-center rounded-md bg-primary text-white shadow-md transition duration-300 ease-in-out hover:bg-dark"
    >
      <span
        class="mt-[6px] h-3 w-3 rotate-45 border-l border-t border-white"
      ></span>
    </a>
    <!-- ====== Back To Top End -->


    <!-- ====== All Scripts -->
    


    <script src="/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/blogs.js"></script>


    <script>
      document.addEventListener('DOMContentLoaded', function () {
        function formatNumber(num) {
          if (num >= 1000000) {
            return (num / 1000000).toFixed(1) + 'M';
          } else if (num >= 10000) {
            return (num / 1000).toFixed(1) + 'k';
          } else {
            return num;
          }
        }
    
        const userBlogCount = document.getElementById('userBlogCount');
        const totalUserViews = document.getElementById('totalUserViews');
        const followersCount = document.getElementById('followersCount');
    
        userBlogCount.textContent = formatNumber(parseInt(userBlogCount.textContent));
        totalUserViews.textContent = formatNumber(parseInt(totalUserViews.textContent));
        followersCount.textContent = formatNumber(parseInt(followersCount.textContent));
      });
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const followButton = document.getElementById('followButton');
        const editProfileButton = document.getElementById('editProfileButton');
        const userId = "<%= user ? user._id : '' %>";
        const followUserId = '<%= userDetails._id %>';

        if (userId === followUserId) {
          followButton.style.display = 'none';
        } else {
          editProfileButton.style.display = 'none';
        }
      });

      document.getElementById('followButton').addEventListener('click', function () {
        const followButton = this;
        const userId = "<%= user ? user._id : '' %>";
        const followUserId = '<%= userDetails._id %>';

        if (userId === '') {
          Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'you need to login to follow this user',
            customClass: {
              popup: 'bg-[#F4F7FF] dark:bg-gray-800 text-[#333] dark:text-gray-200',
              title: 'text-[#1a202c] dark:text-gray-100',
              confirmButton: 'bg-[#1a202c] text-white dark:bg-gray-700',
              cancelButton: 'bg-[#e53e3e] text-white dark:bg-red-600'
            }
          });
          return;
        }

        if (userId === followUserId) {
          followButton.disabled = true;
          return;
        }

        $.ajax({
          url: `/follow/${followUserId}`,
          method: 'PATCH',
          contentType: 'application/json',
          data: JSON.stringify({ userId: userId }),
          success: function (data) {
            if (data.success) {
              if ($(followButton).hasClass('bg-primary')) {
                $(followButton).removeClass('bg-primary').addClass('bg-gray-500');
                followButton.textContent = 'Following';
              } else {
                $(followButton).removeClass('bg-gray-500').addClass('bg-primary');
                followButton.textContent = 'Follow';
              }
            } else {
              alert('Error: ' + data.error);
            }
          },
          error: function (xhr, status, error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
          }
        });
      });
    </script>
  </body>
</html>
