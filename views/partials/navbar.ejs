<div class="ud-header absolute left-0 top-0 z-40 flex w-full items-center bg-transparent">
  <div class="container">
    <div class="relative -mx-4 flex items-center justify-between">
      <div class="w-60 max-w-full px-4">
        <a href="/" class="navbar-logo block w-full">
          <svg id="logo" width="132" height="46" viewBox="0 0 132 46" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Default logo content for light theme -->
            <g id="logo-light" clip-path="url(#clip0_2151_1148)">
              <path
                d="M54.9519 12.0439C56.8799 12.0439 58.5538 12.3618 59.9734 12.9974C61.4142 13.633 62.5159 14.5441 63.2787 15.7306C64.0415 16.9172 64.4228 18.3261 64.4228 19.9576C64.4228 21.5679 64.0415 22.9769 63.2787 24.1846C62.5159 25.3712 61.4142 26.2822 59.9734 26.9178C58.5538 27.5535 56.8799 27.8713 54.9519 27.8713H49.9303V34.2912H45.7987V12.0439H54.9519ZM54.7612 24.3753C56.5621 24.3753 57.9287 23.9939 58.861 23.2311C59.7933 22.4684 60.2594 21.3772 60.2594 19.9576C60.2594 18.5381 59.7933 17.4469 58.861 16.6841C57.9287 15.9213 56.5621 15.5399 54.7612 15.5399H49.9303V24.3753H54.7612ZM68.967 12.0439H73.0986V30.7952H84.7308V34.2912H68.967V12.0439ZM104.668 29.1426H93.5439L91.351 34.2912H87.0922L97.1035 12.0439H101.172L111.215 34.2912H106.892L104.668 29.1426ZM103.301 25.9008L99.1058 16.1756L94.9423 25.9008H103.301ZM122.726 26.4411V34.2912H118.594V26.5047L109.854 12.0439H114.272L120.787 22.8815L127.366 12.0439H131.434L122.726 26.4411Z"
                fill="#111928" />
              <path
                d="M16.7273 39.309C25.9655 39.309 33.4545 31.82 33.4545 22.5818C33.4545 13.3435 25.9655 5.85449 16.7273 5.85449C7.48905 5.85449 0 13.3435 0 22.5818C0 31.82 7.48905 39.309 16.7273 39.309Z"
                fill="#3758F9" />
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M10.5175 25.6612C8.74328 22.7044 9.0391 20.0428 11.4046 17.6774C14.9529 14.1289 18.0578 16.3467 20.2756 15.0161C21.7542 14.1289 22.3456 12.6506 22.0497 10.5806C23.8239 13.5374 23.5282 16.1989 21.1627 18.5644C17.6142 22.1128 14.5094 19.8951 12.2917 21.2257C10.813 22.1128 10.2217 23.5912 10.5175 25.6612ZM11.4046 35.4193C9.63041 32.4625 9.92614 29.801 12.2917 27.4354C15.8401 23.887 18.9449 26.1047 21.1627 24.7742C22.6413 23.887 23.2326 22.4086 22.9369 20.3387C24.711 23.2955 24.4152 25.957 22.0497 28.3225C18.5014 31.8709 15.3965 29.6532 13.1788 30.9838C11.7001 31.8709 11.1088 33.3493 11.4046 35.4193Z"
                fill="white" />
            </g>
            <defs>
              <clipPath id="clip0_2151_1148">
                <rect width="131.309" height="46" fill="white" />
              </clipPath>
            </defs>
            <!-- Default logo content for dark theme -->
            <g clip-path="url(#clip0_2005_10874)" id="logo-dark" style="display: none;">
              <path
                d="M54.9519 12.0439C56.8799 12.0439 58.5538 12.3618 59.9734 12.9974C61.4142 13.633 62.5159 14.5441 63.2787 15.7306C64.0415 16.9172 64.4228 18.3261 64.4228 19.9576C64.4228 21.5679 64.0415 22.9769 63.2787 24.1846C62.5159 25.3712 61.4142 26.2822 59.9734 26.9178C58.5538 27.5535 56.8799 27.8713 54.9519 27.8713H49.9303V34.2912H45.7987V12.0439H54.9519ZM54.7612 24.3753C56.5621 24.3753 57.9287 23.9939 58.861 23.2311C59.7933 22.4684 60.2594 21.3772 60.2594 19.9576C60.2594 18.5381 59.7933 17.4469 58.861 16.6841C57.9287 15.9213 56.5621 15.5399 54.7612 15.5399H49.9303V24.3753H54.7612ZM68.967 12.0439H73.0986V30.7952H84.7308V34.2912H68.967V12.0439ZM104.668 29.1426H93.5439L91.351 34.2912H87.0922L97.1035 12.0439H101.172L111.215 34.2912H106.892L104.668 29.1426ZM103.301 25.9008L99.1058 16.1756L94.9423 25.9008H103.301ZM122.726 26.4411V34.2912H118.594V26.5047L109.854 12.0439H114.272L120.787 22.8815L127.366 12.0439H131.434L122.726 26.4411Z"
                fill="white" />
              <path
                d="M16.7273 39.309C25.9655 39.309 33.4545 31.82 33.4545 22.5818C33.4545 13.3435 25.9655 5.85449 16.7273 5.85449C7.48905 5.85449 0 13.3435 0 22.5818C0 31.82 7.48905 39.309 16.7273 39.309Z"
                fill="white" />
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M10.5175 25.6612C8.74328 22.7044 9.0391 20.0428 11.4046 17.6774C14.9529 14.1289 18.0578 16.3467 20.2756 15.0161C21.7542 14.1289 22.3456 12.6506 22.0497 10.5806C23.8239 13.5374 23.5282 16.1989 21.1627 18.5644C17.6142 22.1128 14.5094 19.8951 12.2917 21.2257C10.813 22.1128 10.2217 23.5912 10.5175 25.6612ZM11.4046 35.4193C9.63041 32.4625 9.92614 29.801 12.2917 27.4354C15.8401 23.887 18.9449 26.1047 21.1627 24.7742C22.6413 23.887 23.2326 22.4086 22.9369 20.3387C24.711 23.2955 24.4152 25.957 22.0497 28.3225C18.5014 31.8709 15.3965 29.6532 13.1788 30.9838C11.7001 31.8709 11.1088 33.3493 11.4046 35.4193Z"
                fill="#3056D3" />
            </g>
            <defs>
              <clipPath id="clip0_2005_10874">
                <rect width="131.309" height="46" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </a>
      </div>
      <div class="flex w-full items-center justify-end px-4">
        <div>
          <button id="navbarToggler"
            class="absolute right-4 top-1/2 block -translate-y-1/2 rounded-lg px-3 py-[6px] ring-primary focus:ring-2 lg:hidden">
            <span class="relative my-[6px] block h-[2px] w-[30px] bg-white"></span>
            <span class="relative my-[6px] block h-[2px] w-[30px] bg-white"></span>
            <span class="relative my-[6px] block h-[2px] w-[30px] bg-white"></span>
          </button>
          <nav id="navbarCollapse"
            class="absolute right-4 top-full hidden w-full max-w-[250px] rounded-lg bg-white py-5 shadow-lg dark:bg-dark-2 lg:static lg:block lg:w-full lg:max-w-full lg:bg-transparent lg:px-4 lg:py-0 lg:shadow-none dark:lg:bg-transparent xl:px-6">

            <ul class="block lg:flex 2xl:ml-20">
              <li class="group relative">
                <div class="flex flex-col items-center lg:hidden">
                  <% if (user) { %>
                    <div class="flex flex-row items-center py-2 justify-center rounded-lg shadow-lg p-4">
                      <img src="<%= user.avatar %>" alt="User Avatar"
                        class="w-10 h-10 rounded-full border-2 border-white shadow-sm">
                      <span class="ml-4 text-base font-medium dark:text-white text-black">
                        Welcome, <%= user.username %>
                      </span>
                    </div>
                    <% } else { %>
                      <a href="/signin"
                        class="loginBtn px-[22px] py-2 text-base font-medium text-white hover:opacity-70">
                        Sign In
                      </a>
                      <a href="/signup"
                        class="signUpBtn rounded-md bg-white bg-opacity-20 px-6 py-2 text-base font-medium text-white duration-300 ease-in-out hover:bg-opacity-100 hover:text-dark">
                        Sign Up
                      </a>
                      <% } %>
                </div>
              </li>

              <li class="group relative flex items-center justify-center lg:hidden">
                <% if (user) { %>
                  <a href="/user/<%= user.id %>"
                    class="loginBtn w-full text-center px-[22px] py-2 text-base font-bold  items-center justify-center rounded-md dark:text-white text-black transition duration-150 ease-in-out">
                    Profile
                  </a>
                  <% } %>
              </li>

              <li class="submenu-item group relative">
                <a href="javascript:void(0)"
                  class="relative mx-8 flex items-center justify-between py-2 text-base font-medium text-dark group-hover:text-primary dark:text-white lg:ml-8 lg:mr-0 lg:inline-flex lg:py-6 lg:pl-0 lg:pr-4 lg:group-hover:text-white lg:group-hover:opacity-70 xl:ml-10">
                  Pages

                  <svg class="ml-2 fill-current" width="16" height="20" viewBox="0 0 16 20" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M7.99999 14.9C7.84999 14.9 7.72499 14.85 7.59999 14.75L1.84999 9.10005C1.62499 8.87505 1.62499 8.52505 1.84999 8.30005C2.07499 8.07505 2.42499 8.07505 2.64999 8.30005L7.99999 13.525L13.35 8.25005C13.575 8.02505 13.925 8.02505 14.15 8.25005C14.375 8.47505 14.375 8.82505 14.15 9.05005L8.39999 14.7C8.27499 14.825 8.14999 14.9 7.99999 14.9Z" />
                  </svg>
                </a>
                <div
                  class="submenu relative left-0 top-full hidden w-[250px] rounded-sm bg-white p-4 transition-[top] duration-300 group-hover:opacity-100 dark:bg-dark-2 lg:invisible lg:absolute lg:top-[110%] lg:block lg:opacity-0 lg:shadow-lg lg:group-hover:visible lg:group-hover:top-full">
                  <a href="/about"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    About Page
                  </a>
                  <a href="/pricing"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    Pricing Page
                  </a>
                  <a href="/contact"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    Contact Page
                  </a>
                  <a href="/blogs"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    Blog Grid Page
                  </a>
                  <a href="/blog-create"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    Blog Create Page
                  </a>
                  <a href="/my-blogs"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    My Blogs
                  </a>
                  <a href="/bookmarked-blogs"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    Bookmarked
                  </a>
                  <a href="/signup"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    Sign Up Page
                  </a>
                  <a href="/signin"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    Sign In Page
                  </a>
                  <a href="/404"
                    class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                    404 Page
                  </a>

                  <% if (user && user.role==='admin' ) { %>
                    <a href="/admin"
                      class="block rounded px-4 py-[10px] text-sm text-body-color hover:text-primary dark:text-dark-6 dark:hover:text-primary">
                      Admin Dashboard
                    </a>
                    <% } %>
                </div>
              </li>
              <li class="group relative flex items-center justify-center lg:hidden">
                <% if (user) { %>
                  <a href="/logout"
                    class="loginBtn w-full text-center px-[22px] py-2 text-base font-bold hover:text-primary items-center justify-center rounded-md bg-primary text-white shadow-md transition duration-150 ease-in-out group-hover:hover:bg-white">
                    Logout
                  </a>
                  <% } %>
              </li>

            </ul>
          </nav>
        </div>
        <div class="flex items-center justify-end pr-16 lg:pr-0">
          <label for="themeSwitcher" class="inline-flex cursor-pointer items-center" aria-label="themeSwitcher"
            name="themeSwitcher">
            <input type="checkbox" name="themeSwitcher" id="themeSwitcher" class="sr-only" />
            <span class="block dark:text-white dark:hidden">
              <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M13.3125 1.50001C12.675 1.31251 12.0375 1.16251 11.3625 1.05001C10.875 0.975006 10.35 1.23751 10.1625 1.68751C9.93751 2.13751 10.05 2.70001 10.425 3.00001C13.0875 5.47501 14.0625 9.11251 12.975 12.525C11.775 16.3125 8.25001 18.975 4.16251 19.0875C3.63751 19.0875 3.22501 19.425 3.07501 19.9125C2.92501 20.4 3.15001 20.925 3.56251 21.1875C4.50001 21.75 5.43751 22.2 6.37501 22.5C7.46251 22.8375 8.58751 22.9875 9.71251 22.9875C11.625 22.9875 13.5 22.5 15.1875 21.5625C17.85 20.1 19.725 17.7375 20.55 14.8875C22.1625 9.26251 18.975 3.37501 13.3125 1.50001ZM18.9375 14.4C18.2625 16.8375 16.6125 18.825 14.4 20.0625C12.075 21.3375 9.41251 21.6 6.90001 20.85C6.63751 20.775 6.33751 20.6625 6.07501 20.55C10.05 19.7625 13.35 16.9125 14.5875 13.0125C15.675 9.56251 15 5.92501 12.7875 3.07501C17.5875 4.68751 20.2875 9.67501 18.9375 14.4Z" />
              </svg>
            </span>
            <span class="hidden text-white dark:block">
              <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_2172_3070)">
                  <path
                    d="M12 6.89999C9.18752 6.89999 6.90002 9.18749 6.90002 12C6.90002 14.8125 9.18752 17.1 12 17.1C14.8125 17.1 17.1 14.8125 17.1 12C17.1 9.18749 14.8125 6.89999 12 6.89999ZM12 15.4125C10.125 15.4125 8.58752 13.875 8.58752 12C8.58752 10.125 10.125 8.58749 12 8.58749C13.875 8.58749 15.4125 10.125 15.4125 12C15.4125 13.875 13.875 15.4125 12 15.4125Z" />
                  <path
                    d="M12 4.2375C12.45 4.2375 12.8625 3.8625 12.8625 3.375V1.5C12.8625 1.05 12.4875 0.637497 12 0.637497C11.55 0.637497 11.1375 1.0125 11.1375 1.5V3.4125C11.175 3.8625 11.55 4.2375 12 4.2375Z" />
                  <path
                    d="M12 19.7625C11.55 19.7625 11.1375 20.1375 11.1375 20.625V22.5C11.1375 22.95 11.5125 23.3625 12 23.3625C12.45 23.3625 12.8625 22.9875 12.8625 22.5V20.5875C12.8625 20.1375 12.45 19.7625 12 19.7625Z" />
                  <path
                    d="M18.1125 6.74999C18.3375 6.74999 18.5625 6.67499 18.7125 6.48749L19.9125 5.28749C20.25 4.94999 20.25 4.42499 19.9125 4.08749C19.575 3.74999 19.05 3.74999 18.7125 4.08749L17.5125 5.28749C17.175 5.62499 17.175 6.14999 17.5125 6.48749C17.6625 6.67499 17.8875 6.74999 18.1125 6.74999Z" />
                  <path
                    d="M5.32501 17.5125L4.12501 18.675C3.78751 19.0125 3.78751 19.5375 4.12501 19.875C4.27501 20.025 4.50001 20.1375 4.72501 20.1375C4.95001 20.1375 5.17501 20.0625 5.32501 19.875L6.52501 18.675C6.86251 18.3375 6.86251 17.8125 6.52501 17.475C6.18751 17.175 5.62501 17.175 5.32501 17.5125Z" />
                  <path
                    d="M22.5 11.175H20.5875C20.1375 11.175 19.725 11.55 19.725 12.0375C19.725 12.4875 20.1 12.9 20.5875 12.9H22.5C22.95 12.9 23.3625 12.525 23.3625 12.0375C23.3625 11.55 22.95 11.175 22.5 11.175Z" />
                  <path
                    d="M4.23751 12C4.23751 11.55 3.86251 11.1375 3.37501 11.1375H1.50001C1.05001 11.1375 0.637512 11.5125 0.637512 12C0.637512 12.45 1.01251 12.8625 1.50001 12.8625H3.41251C3.86251 12.8625 4.23751 12.45 4.23751 12Z" />
                  <path
                    d="M18.675 17.5125C18.3375 17.175 17.8125 17.175 17.475 17.5125C17.1375 17.85 17.1375 18.375 17.475 18.7125L18.675 19.9125C18.825 20.0625 19.05 20.175 19.275 20.175C19.5 20.175 19.725 20.1 19.875 19.9125C20.2125 19.575 20.2125 19.05 19.875 18.7125L18.675 17.5125Z" />
                  <path
                    d="M5.32501 4.125C4.98751 3.7875 4.46251 3.7875 4.12501 4.125C3.78751 4.4625 3.78751 4.9875 4.12501 5.325L5.32501 6.525C5.47501 6.675 5.70001 6.7875 5.92501 6.7875C6.15001 6.7875 6.37501 6.7125 6.52501 6.525C6.86251 6.1875 6.86251 5.6625 6.52501 5.325L5.32501 4.125Z" />
                </g>

                <defs>
                  <clipPath id="clip0_2172_3070">
                    <rect width="24" height="24" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            </span>
            <div class="group relative flex items-center justify-center ml-4">
              <a href="/blog-create"
                class="group flex h-10 w-10 items-center justify-center rounded-md bg-primary text-white shadow-md transition duration-150 ease-in-out group-hover:hover:bg-white">
                <svg class="h-5 w-5 text-white group-hover:text-primary fill-current" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 448 512">
                  <path
                    d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z" />
                </svg>
              </a>
            </div>

          </label>
          <!-- Notification  -->
          <% if (user) { %>
            <div class="group relative flex flex-col items-center justify-center ml-4">
              <button id="notificationButton"
                class="group flex h-10 w-10 items-center justify-center rounded-md bg-primary text-white shadow-md transition duration-150 ease-in-out group-hover:hover:bg-white">
                <svg class="h-5 w-5 text-white group-hover:text-primary fill-current" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 448 512">
                  <path
                    d="M224 512c35.3 0 64-28.7 64-64H160c0 35.3 28.7 64 64 64zm215.4-149.1c-19.8-20.9-55.4-52.1-55.4-154.9 0-77.7-54.5-139.2-127.9-155.2V32c0-17.7-14.3-32-32-32s-32 14.3-32 32v20.8C118.5 68.8 64 130.3 64 208c0 102.8-35.6 134-55.4 154.9-6 6.4-8.6 14.1-8.6 22.1 0 16.3 13.2 32 32 32h384c18.8 0 32-15.7 32-32 0-8-2.6-15.7-8.6-22.1z" />
                </svg>
                <span id="notificationDot" class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full hidden"></span>
              </button>


            </div>
            <!-- Dropdown menu -->

            <% } %>

        </div>

        <div id="notificationDropdown"
          class="z-20 hidden absolute top-4 bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-800 dark:divide-gray-700"
          aria-labelledby="dropdownNotificationButton">
        </div>

        <div class="hidden lg:flex lg:items-center lg:w-auto">
          <% if (user) { %>
            <div class="flex flex-row px-[24px] items-center py-2 justify-center">
              <img src="<%= user.avatar %>" alt="User Avatar"
                class="w-10 h-10 rounded-full border-2 border-white shadow-sm cursor-pointer" id="userAvatar">
              <span class="px-[10px] py-2 text-base font-medium dark:text-white text-black whitespace-nowrap">
                Welcome, <%= user.username %>
              </span>
              <div id="userDropdown"
                class="hidden flex-col absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-2 z-20 transition transform duration-300 ease-in-out opacity-0 translate-y-4">
                <a href="/user/<%= user.id %>"
                  class="block px-4 py-2 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700">Profile</a>
                <a href="/logout"
                  class="w-full text-center px-[22px] py-2 text-base font-bold hover:text-primary items-center justify-center rounded-md bg-primary text-white shadow-md transition duration-150 ease-in-out dark:hover:bg-white">Logout</a>
              </div>
            </div>
            <% } else { %>
              <a href="/signin" class="loginBtn px-[22px] py-2 text-base font-medium dark:text-white hover:opacity-70">
                Sign In
              </a>
              <a href="/signup"
                class="signUpBtn rounded-md bg-white bg-opacity-20 px-6 py-2 text-base font-medium dark:text-white duration-300 ease-in-out hover:bg-opacity-100 dark:hover:text-dark">
                Sign Up
              </a>
              <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('userAvatar').addEventListener('click', function () {
    var dropdown = document.getElementById('userDropdown');
    if (dropdown.classList.contains('hidden')) {
      dropdown.classList.remove('hidden');
      dropdown.classList.add('flex');
      setTimeout(() => {
        dropdown.classList.remove('opacity-0', 'translate-y-4');
        dropdown.classList.add('opacity-100', 'translate-y-20');
      }, 10);
    } else {
      dropdown.classList.add('opacity-0', 'translate-y-4');
      dropdown.classList.remove('opacity-100', 'translate-y-0');
      setTimeout(() => {
        dropdown.classList.add('hidden');
        dropdown.classList.remove('flex');
      }, 300);
    }
  });

  // Close the dropdown if the user clicks outside of it
  window.addEventListener('click', function (event) {
    var dropdown = document.getElementById('userDropdown');
    if (!event.target.matches('#userAvatar')) {
      if (!dropdown.classList.contains('hidden')) {
        dropdown.classList.add('opacity-0', 'translate-y-4');
        dropdown.classList.remove('opacity-100', 'translate-y-0');
        setTimeout(() => {
          dropdown.classList.add('hidden');
        }, 300);
      }
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', async function () {
    const fetchNotifications = async () => {
      try {
        const response = await fetch('/notifications');
        const notifications = await response.json();
        const unreadNotifications = notifications.filter(notification => !notification.read);

        if (unreadNotifications.length > 0) {
          document.getElementById('notificationDot').classList.remove('hidden');
        } else {
          document.getElementById('notificationDot').classList.add('hidden');
        }
      } catch (error) {
        console.error('Error fetching notifications:', error);
      }
    };
    fetchNotifications();

    setInterval(fetchNotifications, 10000);
  });

  document.getElementById('notificationButton').addEventListener('click', async function () {
    const dropdown = document.getElementById('notificationDropdown');
    dropdown.classList.toggle('hidden');

    if (!dropdown.classList.contains('hidden')) {
      try {
        const response = await fetch('/notifications');
        const notifications = await response.json();

        // Sort notifications by createdAt in descending order
        notifications.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

        const notificationContainer = document.getElementById('notificationDropdown');
        notificationContainer.innerHTML = '';

        if (notifications.length === 0) {
          notificationContainer.innerHTML = '<div class="rounded-lg px-4 py-2 text-gray-700 dark:text-gray-200">No new notifications</div>';
        } else {
          notifications.forEach(notification => {
            const notificationItem = document.createElement('a');
            notificationItem.href = notification.url;
            notificationItem.className = 'flex rounded-lg px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700';
            notificationItem.innerHTML = `
              <div class="w-full ps-3">
                <div class="text-gray-500 text-sm mb-1.5 dark:text-gray-400">
                  <span class="font-semibold text-gray-900 dark:text-white">${notification.message}</span>
                </div>
                <div class="text-xs text-blue-600 dark:text-blue-500">${timeAgo(notification.createdAt)}</div>
              </div>
            `;
            notificationContainer.appendChild(notificationItem);
          });
        }

        // Mark notifications as read
        await fetch('/notifications/mark-read', { method: 'POST' });
        document.getElementById('notificationDot').classList.add('hidden');
      } catch (error) {
        console.error('Error fetching notifications:', error);
      }
    }
  });

  // Close the dropdown if the user clicks outside of it
  window.addEventListener('click', function (event) {
    const dropdown = document.getElementById('notificationDropdown');
    const button = document.getElementById('notificationButton');
    if (!dropdown.contains(event.target) && !button.contains(event.target)) {
      dropdown.classList.add('hidden');
    }
  });

  function timeAgo(date) {
    const now = new Date();
    const secondsPast = (now.getTime() - new Date(date).getTime()) / 1000;

    if (secondsPast < 60) {
      return `${Math.floor(secondsPast)} seconds ago`;
    }
    if (secondsPast < 3600) {
      return `${Math.floor(secondsPast / 60)} minutes ago`;
    }
    if (secondsPast <= 86400) {
      return `${Math.floor(secondsPast / 3600)} hours ago`;
    }
    if (secondsPast > 86400) {
      const day = new Date(date).getDate();
      const month = new Date(date).toDateString().match(/ [a-zA-Z]*/)[0].replace(" ", "");
      const year = new Date(date).getFullYear() === now.getFullYear() ? "" : ` ${new Date(date).getFullYear()}`;
      return `${day} ${month}${year}`;
    }
  }
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const logoLight = document.getElementById('logo-light');
    const logoDark = document.getElementById('logo-dark');

    function updateLogo() {
      if (document.documentElement.classList.contains('dark')) {
        logoLight.style.display = 'none';
        logoDark.style.display = 'block';
      } else {
        logoLight.style.display = 'block';
        logoDark.style.display = 'none';
      }
    }

    // Initial logo update
    updateLogo();

    // Update logo on theme change
    const themeSwitcher = document.getElementById('themeSwitcher');
    if (themeSwitcher) {
      themeSwitcher.addEventListener('change', updateLogo);
    }

    // Update logo on manual theme switch
    const observer = new MutationObserver(updateLogo);
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
  });
</script>