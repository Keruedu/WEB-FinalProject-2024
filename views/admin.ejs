<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link
  rel="shortcut icon"
  href="/images/favicon.png"
  type="image/x-icon"
/>
  <link rel="stylesheet" href="/css/animate.css" />
  <link rel="stylesheet" href="/css/tailwind.css" />
  <script src="/js/wow.min.js"></script>
  <script>
    new WOW().init();
  </script>
</head>
<body>
  <%- include('partials/navbar') %>

  <section class="pt-[150px] pb-[120px]">
    <div class="container">
      <div class="wow fadeInUp" data-wow-delay=".2s">
        <div class="-mx-4 flex flex-wrap">
          <div class="w-full px-4">
            <div class="mx-auto mb-12 max-w-[510px] text-center lg:mb-20">
              <h2 class="mb-3 text-3xl font-bold leading-[1.2] text-dark dark:text-white sm:text-4xl md:text-[40px]">
                User Management
              </h2>
            </div>
          </div>
        </div>

        <!-- Thêm đoạn debug này ở đầu file -->
        <% if (typeof users === 'undefined') { %>
          <script>console.log('Users is undefined');</script>
        <% } else { %>
          <script>
            const userCount = '<%= users.length %>';
            console.log('Number of users:', userCount);
          </script>
        <% } %>

        <!-- Users List -->
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white dark:bg-dark-2 rounded-lg overflow-hidden">
            <thead class="bg-gray-100 dark:bg-dark-3">
              <tr>
                <th class="px-6 py-3 text-left">Username</th>
                <th class="px-6 py-3 text-left">Email</th>
                <th class="px-6 py-3 text-left">Role</th>
                <th class="px-6 py-3 text-left">Premium</th>
                <th class="px-6 py-3 text-left">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach(user => { %>
                <tr class="border-b dark:border-dark-3">
                  <td class="px-6 py-4"><%= user.username %></td>
                  <td class="px-6 py-4"><%= user.email %></td>
                  <td class="px-6 py-4"><%= user.role %></td>
                  <td class="px-6 py-4"><%= user.isPremium ? 'Yes' : 'No' %></td>
                  <td class="px-6 py-4">
                    <% if (user.role !== 'admin') { %>
                      <div class="relative inline-block text-left">
                        <button onclick="toggleDropdown('<%= user._id %>')" class="inline-flex items-center p-1 hover:bg-gray-100 rounded">
                          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                          </svg>
                        </button>
                        <div id="dropdown-<%= user._id %>" class="hidden absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-dark-2 z-50">
                          <div class="py-1">
                            <button 
                              class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-dark-3"
                              onclick="alert('Chức năng này sẽ được triển khai sau')"
                            >
                              Ban User
                            </button>
                          </div>
                        </div>
                      </div>
                    <% } %>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
          <!-- Sau phần table -->
          <div class="mt-8 flex justify-center">
            <%- include('partials/pagination') %>
          </div>

        </div>
      </div>
    </div>
  </section>

  <script>
  function toggleDropdown(userId) {
    const dropdown = document.getElementById(`dropdown-${userId}`);
    const allDropdowns = document.querySelectorAll('[id^="dropdown-"]');
    
    // Hide all other dropdowns
    allDropdowns.forEach(d => {
      if (d.id !== `dropdown-${userId}`) {
        d.classList.add('hidden');
      }
    });
    
    // Toggle current dropdown
    dropdown.classList.toggle('hidden');
  }

  // Close dropdowns when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('button')) {
      const allDropdowns = document.querySelectorAll('[id^="dropdown-"]');
      allDropdowns.forEach(d => d.classList.add('hidden'));
    }
  });
  </script>

  <%- include('partials/footer') %>
</body>
</html> 